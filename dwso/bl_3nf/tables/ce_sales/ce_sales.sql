DROP TABLE ce_sales;
CREATE TABLE ce_sales (
    sales_src_id          VARCHAR2(50) NOT NULL,
    source_entity         VARCHAR2(30) NOT NULL,
    source_system         VARCHAR2(30) NOT NULL,
    book_surr_id          NUMBER  NOT NULL,
    date_sale             DATE NOT NULL,
    customer_surr_id      NUMBER NOT NULL,
    employee_surr_id      NUMBER NOT NULL,
    store_surr_id         NUMBER NOT NULL,
    address_surr_id       NUMBER NOT NULL,
    type_payment_surr_id  NUMBER NOT NULL,
    quantity              NUMBER NOT NULL,
    sale_amount           NUMBER(10, 2) NOT NULL,
    num_invoice           VARCHAR2(20) NOT NULL,
    update_dt             DATE NOT NULL,
    insert_dt             DATE NOT NULL
)
PARTITION BY RANGE (date_sale)
(PARTITION p_202001 VALUES LESS THAN (TO_DATE('01.02.2020', 'DD.MM.YYYY')),
 PARTITION p_202002 VALUES LESS THAN (TO_DATE('01.03.2020', 'DD.MM.YYYY')),
 PARTITION p_202003 VALUES LESS THAN (TO_DATE('01.04.2020', 'DD.MM.YYYY')), 
 PARTITION p_202004 VALUES LESS THAN (TO_DATE('01.05.2020', 'DD.MM.YYYY')),
 PARTITION p_202005 VALUES LESS THAN (TO_DATE('01.06.2020', 'DD.MM.YYYY')),
 PARTITION p_202006 VALUES LESS THAN (TO_DATE('01.07.2020', 'DD.MM.YYYY')),
 PARTITION p_202007 VALUES LESS THAN (TO_DATE('01.08.2020', 'DD.MM.YYYY')),
 PARTITION p_202008 VALUES LESS THAN (TO_DATE('01.09.2020', 'DD.MM.YYYY')),
 PARTITION p_202009 VALUES LESS THAN (TO_DATE('01.10.2020', 'DD.MM.YYYY')),
 PARTITION p_202010 VALUES LESS THAN (TO_DATE('01.11.2020', 'DD.MM.YYYY')),
 PARTITION p_202011 VALUES LESS THAN (TO_DATE('01.12.2020', 'DD.MM.YYYY')),
 PARTITION p_202012 VALUES LESS THAN (TO_DATE('01.01.2021', 'DD.MM.YYYY')),
 PARTITION p_202101 VALUES LESS THAN (TO_DATE('01.02.2021', 'DD.MM.YYYY')),
 PARTITION p_202102 VALUES LESS THAN (TO_DATE('01.03.2021', 'DD.MM.YYYY')),
 PARTITION p_202103 VALUES LESS THAN (TO_DATE('01.04.2021', 'DD.MM.YYYY')),
 PARTITION p_202104 VALUES LESS THAN (TO_DATE('01.05.2021', 'DD.MM.YYYY')),
 PARTITION p_202105 VALUES LESS THAN (TO_DATE('01.06.2021', 'DD.MM.YYYY')),
 PARTITION p_202106 VALUES LESS THAN (TO_DATE('01.07.2021', 'DD.MM.YYYY')),
 PARTITION p_202107 VALUES LESS THAN (TO_DATE('01.08.2021', 'DD.MM.YYYY')),
 PARTITION p_202108 VALUES LESS THAN (TO_DATE('01.09.2021', 'DD.MM.YYYY')), 
 PARTITION p_202109 VALUES LESS THAN (TO_DATE('01.10.2021', 'DD.MM.YYYY')),
 PARTITION p_202110 VALUES LESS THAN (TO_DATE('01.11.2021', 'DD.MM.YYYY')),
 PARTITION p_202111 VALUES LESS THAN (TO_DATE('01.12.2021', 'DD.MM.YYYY')),
 PARTITION p_202112 VALUES LESS THAN (TO_DATE('01.01.2022', 'DD.MM.YYYY')),  
 PARTITION p_202201 VALUES LESS THAN (TO_DATE('01.02.2022', 'DD.MM.YYYY')),
 PARTITION p_202202 VALUES LESS THAN (TO_DATE('01.03.2022', 'DD.MM.YYYY')),
 PARTITION p_202203 VALUES LESS THAN (TO_DATE('01.04.2022', 'DD.MM.YYYY')),
 PARTITION p_202204 VALUES LESS THAN (TO_DATE('01.05.2022', 'DD.MM.YYYY')),
 PARTITION p_202205 VALUES LESS THAN (TO_DATE('01.06.2022', 'DD.MM.YYYY')),
 PARTITION p_202206 VALUES LESS THAN (TO_DATE('01.07.2022', 'DD.MM.YYYY')),
 PARTITION p_202207 VALUES LESS THAN (TO_DATE('01.08.2022', 'DD.MM.YYYY')),
 PARTITION p_202208 VALUES LESS THAN (TO_DATE('01.09.2022', 'DD.MM.YYYY')),
 PARTITION p_202209 VALUES LESS THAN (TO_DATE('01.10.2022', 'DD.MM.YYYY')),
 PARTITION p_202210 VALUES LESS THAN (TO_DATE('01.11.2022', 'DD.MM.YYYY')),
 PARTITION p_202211 VALUES LESS THAN (TO_DATE('01.12.2022', 'DD.MM.YYYY')),
 PARTITION p_202212 VALUES LESS THAN (TO_DATE('01.01.2023', 'DD.MM.YYYY')), 
 PARTITION part_def VALUES LESS THAN (MAXVALUE) 
);

--ALTER TABLE ce_sales
--    ADD CONSTRAINT ce_sales_ce_book_fk FOREIGN KEY ( book_surr_id )
--        REFERENCES ce_books ( book_id );

ALTER TABLE ce_sales
    ADD CONSTRAINT ce_sales_ce_customer_fk FOREIGN KEY ( customer_surr_id )
        REFERENCES ce_customers ( customer_id );

ALTER TABLE ce_sales
    ADD CONSTRAINT ce_sales_ce_employee_fk FOREIGN KEY ( employee_surr_id )
        REFERENCES ce_employees ( employee_id );

ALTER TABLE ce_sales
    ADD CONSTRAINT ce_sales_ce_store_fk FOREIGN KEY ( store_surr_id )
        REFERENCES ce_stores ( store_id );

ALTER TABLE ce_sales
    ADD CONSTRAINT ce_sales_ce_type_payment_fk FOREIGN KEY ( type_payment_surr_id )
        REFERENCES ce_type_payments ( type_payment_id );
